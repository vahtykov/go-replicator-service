# Go Replicator Service

–°–µ—Ä–≤–∏—Å real-time —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –º–µ–∂–¥—É –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç—É—Ä–∞–º–∏ —á–µ—Ä–µ–∑ Kafka.

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

üìã **[ARCHITECTURE_OVERVIEW.md](ARCHITECTURE_OVERVIEW.md)** - –ö—Ä–∞—Ç–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è ‚≠ê **–ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê**
- –û–±—â–∞—è —Å—Ö–µ–º–∞ —Å–∏—Å—Ç–µ–º—ã
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: ReplicatorPublisher, ReplicatorConsumer
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ç–ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (–ø–æ–¥—Ä–æ–±–Ω–æ!)
- –î–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

üìö **[HYBRID_SOLUTION.md](HYBRID_SOLUTION.md)** - –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –Ω–∞ Go –∏ SQL
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **Real-time —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è** (1-3 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–∞)  
‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏** (—Ç—Ä–∏–≥–≥–µ—Ä—ã PostgreSQL)  
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö** (replication_queue)  
‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** (processed_events)  
‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)  
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ç–ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏** (–ø—Ä–æ–≤–µ—Ä–∫–∞ application_name)  

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí PostgreSQL [–¢—Ä–∏–≥–≥–µ—Ä—ã] ‚Üí replication_log
                                           ‚Üì
                                   ReplicatorPublisher
                                           ‚Üì
                                        Kafka
                                           ‚Üì
                                   ReplicatorConsumer
                                           ‚Üì
                              PostgreSQL (–¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç—É—Ä)
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL ‚ö°

```bash
# –û–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏!
psql -U your_user -d your_database -f sql/00_master_setup.sql
```

–ó–∞—Ç–µ–º –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ–∏ —Ç–∞–±–ª–∏—Ü—ã:

```sql
-- –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É (–¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è + —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã)
SELECT setup_table_for_replication('users');
SELECT setup_table_for_replication('orders');
SELECT setup_table_for_replication('products');
```

‚úÖ **–¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ INSERT/UPDATE/DELETE
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ `replication_queue`
- –ó–∞—â–∏—â–µ–Ω –æ—Ç –ø–µ—Ç–ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É `application_name`)

üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [sql/README.md](sql/README.md)

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
# ReplicatorPublisher ‚úÖ
make build-publisher
./bin/publisher -config config.publisher.yaml

# –ò–ª–∏ —á–µ—Ä–µ–∑ make
make dev-publisher

# ReplicatorConsumer ‚úÖ
make build-consumer
./bin/consumer -config config.consumer.yaml

# –ò–ª–∏ —á–µ—Ä–µ–∑ make
make dev-consumer

# –°–æ–±—Ä–∞—Ç—å –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞
make build
```

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [sql/README.md](sql/README.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL
- [sql/CHEATSHEET.md](sql/CHEATSHEET.md) - –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ SQL

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
go-replicator-service/
‚îú‚îÄ‚îÄ sql/                          # SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ 00_master_setup.sql      # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ 01_create_tables.sql     # –°–ª—É–∂–µ–±–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
‚îÇ   ‚îú‚îÄ‚îÄ 02_create_replication_trigger.sql  # –§—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ 03_setup_example.sql     # –ü—Ä–∏–º–µ—Ä—ã –∏ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ 04_migrate_existing_tables.sql     # –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
‚îÇ   ‚îú‚îÄ‚îÄ README.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è SQL
‚îÇ   ‚îú‚îÄ‚îÄ CHEATSHEET.md            # –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ FILES.md                 # –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ cmd/                         # –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ publisher/               # ReplicatorPublisher ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ consumer/                # ReplicatorConsumer ‚úÖ
‚îÇ
‚îú‚îÄ‚îÄ internal/                    # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–∞–∫–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config/                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (YAML + env) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ kafka/                   # Kafka producer/consumer ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ database/                # GORM + PostgreSQL ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ logger/                  # Zerolog ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ publisher/               # Publisher –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ consumer/                # Consumer –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚úÖ
‚îÇ
‚îú‚îÄ‚îÄ ARCHITECTURE_OVERVIEW.md     # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (‚≠ê –Ω–∞—á–Ω–∏—Ç–µ –æ—Ç—Å—é–¥–∞)
‚îú‚îÄ‚îÄ HYBRID_SOLUTION.md           # –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ CHANGES_APPLICATION_NAME.md  # –ò–∑–º–µ–Ω–µ–Ω–∏—è: –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ application_name
‚îî‚îÄ‚îÄ README.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PostgreSQL 10+
- Kafka (–≥–µ–æ—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
- Go 1.21+

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

